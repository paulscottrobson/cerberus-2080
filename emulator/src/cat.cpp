// *******************************************************************************************************************************
// *******************************************************************************************************************************
//
//		Name:		cat.cpp
//		Purpose:	CAT code handler.
//		Created:	25th October 2021
//		Author:		Paul Robson (paul@robsons.org.uk)
//
// *******************************************************************************************************************************
// *******************************************************************************************************************************

#include "sys_processor.h"
#include "cat.h"
#include "gfx.h"

static int pendingKey;

static void catbios_setup();
static void catbios_sync();

#include "catbios.h"

// *******************************************************************************************************************************
//
// 														The Cat Setup function
//
// *******************************************************************************************************************************

void CatSetup(int argc,char **argv) {
	pendingKey = 0;

	mode = true;
	cpurunning = (argc == 3);
	fast = false;
	
	catbios_setup();
	if (argc >= 2) {
		if (strstr(argv[1],"65") != NULL) mode = false;
		runCode();
	}
}

// *******************************************************************************************************************************
//
//														 The Cat loop function
//
// *******************************************************************************************************************************

void CatSync(void) {
	catbios_sync();
}

// *******************************************************************************************************************************
//
//										  Returns ASCII of key or 1000+GFX_Key for controls
//
// *******************************************************************************************************************************

int CatKeyHandler(int key,int isInRunMode) {
	if (isInRunMode != 0 && key != 0) {
		pendingKey = GFXToASCII(key,-1);
		if (pendingKey == 0 && key > 0) pendingKey = 1000+key;
	}
	return key;
}


